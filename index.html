<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>3d game</title>
  <style>
    html,
    body {
      overflow: hidden;
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
    #render-canvas {
      width: 100%;
      height: 100%;
      touch-action: none;
    }
  </style>
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
</head>
<body>
  <canvas id="render-canvas"></canvas>
  <script>
    // КОНСТАНТЫ
    const IDLE = 'idle';
    const RIGHT = 'right';
    const LEFT = 'left';

    // ПЕРЕМЕННЫЕ
    let canvas = window.document.querySelector('#render-canvas');
    let engine = new BABYLON.Engine(canvas); 
    let scene = new BABYLON.Scene(engine); 
    let camera = new BABYLON.FreeCamera('camera', new BABYLON.Vector3(0, 0, -10), scene);
    let light = new BABYLON.PointLight('light', new BABYLON.Vector3(10, 10, 0), scene);
    let box = BABYLON.Mesh.CreateBox('box', 2, scene);
    let boxMaterial = new BABYLON.StandardMaterial('material', scene);
    let state = IDLE;

    scene.clearColor = new BABYLON.Color3(0.8, 0.8, 0.8);
    boxMaterial.emissiveColor = new BABYLON.Color3(0, 0.58, 0.86);
    box.material = boxMaterial;
    box.rotation.x = -0.2;
    box.rotation.y = -0.4;

    // ФУНКЦИИ
    const lifeCycle = (dt) => {
      switch(state){
        case RIGHT: {
          box.position.x += 1*dt;
          break;
        }
        case LEFT: {
          box.position.x -= 1*dt;
          break;
        }
        default: break;
      }
    }
    const renderLoop = () => {
      lifeCycle((engine.getDeltaTime()/300));
      scene.render();
    }
    engine.runRenderLoop(renderLoop);

    // ОБРАБОТЧИКИ
    window.addEventListener('keydown', (event) => {
      switch(event.code){
        case 'KeyA':{
          state = LEFT;
          break;
        }
        case 'KeyD': {
          state = RIGHT;
          break;
        }
        default: break;
      }            
    })
    window.addEventListener('keyup', (event) => {
      state = IDLE;
    });
    window.addEventListener('touchstart', (event) => {
      let touchX = event.touches[0].screenX;
      let halfWidth = window.screen.width/2;
      (touchX > halfWidth) ? state = RIGHT : state = LEFT;
    } );
    window.addEventListener('touchend', (event) => {
      state = IDLE;
    });

  </script>

</body>